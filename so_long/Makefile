# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: srudman <srudman@student.42lisboa.com>     +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2024/02/02 13:15:01 by srudman           #+#    #+#              #
#    Updated: 2024/02/11 17:39:34 by srudman          ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

# Path to the directory
BIN_PATH = ./bin/
SRC_PATH = ./src/
BONUS_PATH = ./src_bonus/
OBJ_PATH = ./obj/
LIBFT_PATH = ./libft/
PRINTF_PATH = ./ft_printf/
HEADER_PATH = ./inc/
MLX_PATH = ./mlx/

NAME = ${BIN_PATH}so_long

NAME_BONUS = ${BIN_PATH}so_long_bonus

# Compilation flags
CC = cc # or is it gcc?
CFLAGS = -Wall -Wextra -Werror -fsanitize=address -g
# Linker flags : 'libft', 'mlx' and 'mlx' for Linux, 'lib' for X Window System, 'xext' for a single extension, and 'lm' for the math library
LFLAGS = -lft -lmlx -lmlx_Linux -lX11 -lXext -lm

SRC = main.c \
SRC_BONUS = main_bonus.c \

# Object files
OBJ = $(patsubst %.c, $(OBJ_PATH)%.o, $(SRC))
OBJ_BONUS = $(patsubst %.c, $(OBJ_PATH)%.o, $(SRC_BONUS))
OBJECTS = $(addprefix $(OBJ_PATH), $(OBJ))

all: $(NAME)

bonus: $(NAME_BONUS)

# The target to build the mandatory part
$(NAME): $(OBJ)
	mkdir -p $(BIN_PATH)
	make -C $(LIBFT_PATH) --no-print-directory
	make -C $(PRINTF_PATH) --no-print-directory
	make -C $(MLX_PATH) --no-print-directory
	$(CC) $(CFLAGS) $(OBJ) -o $(NAME) -I $(HEADER_PATH) -L $(LIBFT_PATH) -L $(MLX_PATH) $(LFLAGS)

# Compiles C source files into object files
$(OBJ_PATH)%.o: $(SRC_PATH)%.c $(HEADER_PATH)/*.h
	mkdir -p $(OBJ_PATH)
	$(CC) $(CFLAGS) -I $(HEADER_PATH) -c $< -o $@

# The target to build the bonus part
$(NAME_BONUS): $(OBJ_BONUS)
	mkdir -p $(BIN_PATH)
	make -C $(LIBFT_PATH) --no-print-directory
	make -C $(PRINTF_PATH) --no-print-directory
	make -C $(MLX_PATH) --no-print-directory
	$(CC) $(CFLAGS) $(OBJ_BONUS) -o $(NAME_BONUS) -I $(HEADER_PATH) -L $(LIBFT_PATH) -L $(MLX_PATH) $(LFLAGS)

# Compiles C source bonus files into object files
$(OBJ_PATH)%.o : $(BONUS_PATH)%.c $(HEADER_PATH)/*.h
	mkdir -p $(OBJ_PATH)
	$(CC) $(CFLAGS) -I $(HEADER_PATH) -c $< -o $@

# Cleans object files and dependencies
clean:
	rm -rf $(OBJ_PATH)
	@make clean -C $(LIBFT_PATH) --no-print-directory
	@make clean -C $(PRINTF_PATH) --no-print-directory
	@make clean -C $(MLX_PATH) --no-print-directory

# Cleans everything generated by the Makefile
fclean: clean
	rm -rf $(NAME) $(BIN_PATH) $(OBJ_PATH)
	@make fclean -C $(LIBFT_PATH) --no-print-directory
	@make fclean -C $(PRINTF_PATH) --no-print-directory
	@make fclean -C $(MLX_PATH) --no-print-directory

# Cleans everything generated by the Makefile and rebuild all
re : fclean all

# Phony targets
.PHONY : all bonus clean fclean re